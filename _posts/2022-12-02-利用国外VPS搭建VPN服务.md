---
layout: post
title: 2022-12-02-利用国外VPS搭建VPN服务
date: 2022-12-02
tags: 其他
music-id: 85571
---

## 一、购买国外VPS服务器（云服务器）

购买可选择支付宝购买

国外购买云服务器：https://www.vultr.com/

![](/images/posts/other/利用国外VPS搭建VPN服务/1.png)

## 二、购买国外域名

国外购买域名：https://www.namesilo.com/

**首先登录进入之后购买域名**

购买域名可选择支付宝购买

![](/images/posts/other/利用国外VPS搭建VPN服务/2.png)

**配置域名解析**

![3](/images/posts/other/利用国外VPS搭建VPN服务/3.png)

![4](/images/posts/other/利用国外VPS搭建VPN服务/4.png)

![5](/images/posts/other/利用国外VPS搭建VPN服务/5.png)

![6](/images/posts/other/利用国外VPS搭建VPN服务/6.png)

**测试解析是否正常**

![](/images/posts/other/利用国外VPS搭建VPN服务/7.png)

## 三、搭建 X-ui-VPN

### 1. 基本配置

```sh
#更新软件源
root@vultr:~# apt update

#关闭防火墙
root@vultr:~# apt install ufw
root@vultr:~# ufw disable

#启用 BBR TCP 拥塞控制算法
root@vultr:~# echo "net.core.default_qdisc=fq" >> /etc/sysctl.conf
root@vultr:~# echo "net.ipv4.tcp_congestion_control=bbr" >> /etc/sysctl.conf
root@vultr:~# sysctl -p
root@vultr:~# lsmod |grep bbr
tcp_bbr                20480  6
```

### 2. 安装x-ui

```sh
root@vultr:~# bash <(curl -Ls https://raw.githubusercontent.com/vaxilu/x-ui/master/install.sh)
出于安全考虑，安装/更新完成后需要强制修改端口与账户密码
确认是否继续?[y/n]:y
请设置您的账户名:admin
您的账户名将设定为:admin
请设置您的账户密码:*********
请设置面板访问端口:9999
您的面板访问端口将设定为:9999
确认设定,设定中
set username and password success
账户密码设定完成
set port 9999 success面板端口设定完成
Created symlink /etc/systemd/system/multi-user.target.wants/x-ui.service → /etc/systemd/system/x-ui.service.
x-ui v0.3.2 安装完成，面板已启动，

x-ui 管理脚本使用方法:
----------------------------------------------
x-ui              - 显示管理菜单 (功能更多)
x-ui start        - 启动 x-ui 面板
x-ui stop         - 停止 x-ui 面板
x-ui restart      - 重启 x-ui 面板
x-ui status       - 查看 x-ui 状态
x-ui enable       - 设置 x-ui 开机自启
x-ui disable      - 取消 x-ui 开机自启
x-ui log          - 查看 x-ui 日志
x-ui v2-ui        - 迁移本机器的 v2-ui 账号数据至 x-ui
x-ui update       - 更新 x-ui 面板
x-ui install      - 安装 x-ui 面板
x-ui uninstall    - 卸载 x-ui 面板
----------------------------------------------
```

### 2. 安装 nginx 和自签证书

```sh
root@vultr:~# apt install nginx -y

#安装acme：
root@vultr:~# curl https://get.acme.sh | sh

#添加软链接：
root@vultr:~# ln -s  /root/.acme.sh/acme.sh /usr/local/bin/acme.sh

#切换CA机构：
root@vultr:~# acme.sh --set-default-ca --server letsencrypt

#申请证书：
root@vultr:~# acme.sh  --issue -d blog.linuxtian.xyz -k ec-256 --webroot  /var/www/html

#安装证书：
root@vultr:~# acme.sh --install-cert -d blog.linuxtian.xyz --ecc \
--key-file    /etc/x-ui/server.key \
--fullchain-file /etc/x-ui/server.crt \
--reloadcmd "systemctl force-reload nginx"
```

## 四、配置xui

### 1. 配置控制台访问端口以及访问路径

浏览器访问域名加9999端口

配置的时候先将id复制出来到一个文本中，方便备用

![](/images/posts/other/利用国外VPS搭建VPN服务/9.png)

![](/images/posts/other/利用国外VPS搭建VPN服务/10.png)

重启面板之后发现无法正常打开，因为我们已经修改了访问路径了，所以需要进行下面的步骤

### 2. 寻找适合的伪装站

> http站点优先，个人网盘符合单节点大流量特征
>
> 示例关键字：`intext:登录 Cloudreve`

任意挑选一个记录下来网址

![](/images/posts/other/利用国外VPS搭建VPN服务/8.png)

**配置nginx.conf**

```sh
root@vultr:~# cat /etc/nginx/nginx.conf
user www-data;
worker_processes auto;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;

events {
    worker_connections 1024;
}

http {
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;

    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    gzip on;

    server {
        listen 443 ssl;

        server_name blog.linuxtian.xyz;  #你的域名
        ssl_certificate       /etc/x-ui/server.crt;  #证书位置
        ssl_certificate_key   /etc/x-ui/server.key; #私钥位置

        ssl_session_timeout 1d;
        ssl_session_cache shared:MozSSL:10m;
        ssl_session_tickets off;
        ssl_protocols    TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers off;

        location / {
            proxy_pass https://vir.synas.plus/; #伪装网址
            proxy_redirect off;
            proxy_ssl_server_name on;
            sub_filter_once off;
            sub_filter "vir.synas.plus" $server_name;  #伪装网址
            proxy_set_header Host "vir.synas.plus";  #伪装网址
            proxy_set_header Referer $http_referer;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header User-Agent $http_user_agent;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto https;
            proxy_set_header Accept-Encoding "";
            proxy_set_header Accept-Language "zh-CN";
        }


        location /e2c85d91-264c-4a2b-cf39-44deb0855297 {   #分流路径就是上面xui配置的那个地址
            proxy_redirect off;
            proxy_pass http://127.0.0.1:10000; #Xray端口
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /e2c85d91-264c-4a2b-cf39-44deb0855297-xui {   #xui路径
            proxy_redirect off;
            proxy_pass http://127.0.0.1:9999;  #xui监听端口
            proxy_http_version 1.1;
            proxy_set_header Host $host;
        }
    }

    server {
        listen 80;
        location /.well-known/ {
               root /var/www/html;
            }
        location / {
                rewrite ^(.*)$ https://$host$1 permanent;
            }
    }
}
```

**重新加载nginx服务**

```sh
root@vultr:~# systemctl reload nginx
```

### 3. 添加多用户

**控制台添加机场**

![](/images/posts/other/利用国外VPS搭建VPN服务/20.png)

![](/images/posts/other/利用国外VPS搭建VPN服务/21.png)

**修改nginx配置**

```sh
        location /706e6240-1e8e-4458-c064-c977ee191a5c {   #分流路径用户1
              proxy_redirect off;
              proxy_pass http://127.0.0.1:10001; #Xray端口
              proxy_http_version 1.1;
              proxy_set_header Upgrade $http_upgrade;
              proxy_set_header Connection "upgrade";
              proxy_set_header Host $host;
              proxy_set_header X-Real-IP $remote_addr;
              proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
```
![](/images/posts/other/利用国外VPS搭建VPN服务/22.png)

继续向上面一样复制然后用v2rayN测试连通性

![](/images/posts/other/利用国外VPS搭建VPN服务/23.png)

## 五、验证测试

### 1. 登录控制台

![](/images/posts/other/利用国外VPS搭建VPN服务/11.png)

![](/images/posts/other/利用国外VPS搭建VPN服务/12.png)

![](/images/posts/other/利用国外VPS搭建VPN服务/13.png)

### 2. 使用代理

> Windows 安装 v2rayn：https://github.com/2dust/v2rayN/releases
>
> 安卓安装 v2rayn：https://www.jamesdailylife.com/v2rayn-v2rayng
>
> windows 安装 clash：https://github.com/ender-zhao/Clash-for-Windows_Chinese/releases
>
> 安卓安装 Clash：https://bitznetuk.com/download/cfa-259.apk
>
> Macos 安装 v2rayn：  https://github.com/Cenmrev/V2RayX
>
> IOS 使用小火箭即可

我们这边使用的是 v2rayn 大家有兴趣可以安装 clash

![](/images/posts/other/利用国外VPS搭建VPN服务/14.png)

![](/images/posts/other/利用国外VPS搭建VPN服务/15.png)

![](/images/posts/other/利用国外VPS搭建VPN服务/16.png)

![](/images/posts/other/利用国外VPS搭建VPN服务/17.png)

![](/images/posts/other/利用国外VPS搭建VPN服务/18.png)

将机场导出二维码直接使用小火箭扫码即可

![](/images/posts/other/利用国外VPS搭建VPN服务/19.png)

![](/images/posts/other/利用国外VPS搭建VPN服务/20.jpg)

## 六、安装tiktok

### 1. IOS 安装

(1) 使用爱思助手进行 IPA 签名安装 TikTok (版本较高)

7天后自动到期，到期后继续IPA签名即可

>下载地址：https://www.mediafire.com/file/le4jgqbg4htggdq/tiktok_v25.8.0.ipa/file
>
> 视频教程：https://www.youtube.com/watch?v=IgzX5GjqwTw

![](/images/posts/other/利用国外VPS搭建VPN服务/25.png)

![](/images/posts/other/利用国外VPS搭建VPN服务/26.png)

![](/images/posts/other/利用国外VPS搭建VPN服务/27.png)

![](/images/posts/other/利用国外VPS搭建VPN服务/28.png)

![](/images/posts/other/利用国外VPS搭建VPN服务/29.png)

![](/images/posts/other/利用国外VPS搭建VPN服务/30.png)

![](/images/posts/other/利用国外VPS搭建VPN服务/31.png)


(2) 在线安装 (版本较低)

> 手机Safari打开此链接：https://bage.bgjs888.com/bage/

(3) 登录美区 AppStore 账号进行安装 (需要把卡才能使用)

### 2. Android 安装

apk离线包

> https://github.com/kjfx/rj/releases/tag/tiktok_android


## 七、Linux v2rayn 客户端安装

> 相关文档介绍：https://www.v2ray.com/chapter_00/install.html

### 1. 离线部署

```sh
[root@VM-16-9-centos ~]# wget http://blog.linuxtian.top/data/v2ray-linux-64.zip
[root@VM-16-9-centos ~]# unzip -d /usr/local/etc/v2ray/ v2ray-linux-64.zip
[root@VM-16-9-centos ~]# cd /usr/local/etc/v2ray/
# 启动
[root@VM-16-9-centos ~]# ./v2ray config.json
```

### 2. 官方提供脚本一键安装

```sh
[root@VM-16-9-centos ~]# bash <(curl -L https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh)
info: Installing V2Ray v5.1.0 for x86_64
Downloading V2Ray archive: https://github.com/v2fly/v2ray-core/releases/download/v5.1.0/v2ray-linux-64.zip
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:--  0:00:31 --:--:--     0
100 10.5M  100 10.5M    0     0  35326      0  0:05:13  0:05:13 --:--:-- 32363
Downloading verification file for V2Ray archive: https://github.com/v2fly/v2ray-core/releases/download/v5.1.0/v2ray-linux-64.zip.dgst

warning: The following are the actual parameters for the v2ray service startup.
warning: Please make sure the configuration file path is correctly set.
~~~~~~~~~~~~~~~~
[Unit]
Description=V2Ray Service
Documentation=https://www.v2fly.org/
After=network.target nss-lookup.target

[Service]
User=nobody
CapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_BIND_SERVICE
AmbientCapabilities=CAP_NET_ADMIN CAP_NET_BIND_SERVICE
NoNewPrivileges=true
ExecStart=/usr/local/bin/v2ray run -config /usr/local/etc/v2ray/config.json
Restart=on-failure
RestartPreventExitStatus=23

[Install]
WantedBy=multi-user.target
# In case you have a good reason to do so, duplicate this file in the same directory and make your customizes there.
# Or all changes you made will be lost!  # Refer: https://www.freedesktop.org/software/systemd/man/systemd.unit.html
[Service]
ExecStart=
ExecStart=/usr/local/bin/v2ray run -config /usr/local/etc/v2ray/config.json
~~~~~~~~~~~~~~~~
warning: The systemd version on the current operating system is too low.
warning: Please consider to upgrade the systemd or the operating system.

installed: /usr/local/bin/v2ray
installed: /usr/local/share/v2ray/geoip.dat
installed: /usr/local/share/v2ray/geosite.dat
installed: /usr/local/etc/v2ray/config.json
installed: /var/log/v2ray/
installed: /var/log/v2ray/access.log
installed: /var/log/v2ray/error.log
installed: /etc/systemd/system/v2ray.service
installed: /etc/systemd/system/v2ray@.service
removed: /tmp/tmp.SSvhZRxKam
info: V2Ray v5.1.0 is installed.
You may need to execute a command to remove dependent software: yum remove curl unzip
Please execute the command: systemctl enable v2ray; systemctl start v2ray
```

### 3. 配置机场

方法一：安卓手机下载安装v2ray，然后配置好机场之后导出json文件

```sh
[root@VM-16-9-centos ~]# cd /usr/local/etc/v2ray/
[root@VM-16-9-centos v2ray]# ls
config.json
[root@VM-16-9-centos v2ray]# vim config.json
{
  "dns": {
    "hosts": {
      "domain:googleapis.cn": "googleapis.com"
    },
    "servers": [
      "1.1.1.1",
      {
        "address": "223.5.5.5",
        "domains": [
          "geosite:cn"
        ],
        "expectIPs": [
          "geoip:cn"
        ],
        "port": 53
      }
    ]
  },
  "inbounds": [
    {
      "listen": "127.0.0.1",
      "port": 10808,
      "protocol": "socks",
      "settings": {
        "auth": "noauth",
        "udp": true,
        "userLevel": 8
      },
      "sniffing": {
        "destOverride": [
          "http",
          "tls"
        ],
        "enabled": true
      },
      "tag": "socks"
    },
    {
      "listen": "127.0.0.1",
      "port": 10809,
      "protocol": "http",
      "settings": {
        "userLevel": 8
      },
      "tag": "http"
    },
    {
      "listen": "127.0.0.1",
      "port": 10853,
      "protocol": "dokodemo-door",
      "settings": {
        "address": "1.1.1.1",
        "network": "tcp,udp",
        "port": 53
      },
      "tag": "dns-in"
    }
  ],
  "log": {
    "loglevel": "warning"
  },
  "outbounds": [
    {
      "mux": {
        "concurrency": -1,
        "enabled": false
      },
      "protocol": "vmess",
      "settings": {
        "vnext": [
          {
            "address": "blog.linuxtian.xyz",
            "port": 443,
            "users": [
              {
                "alterId": 0,
                "id": "c77836ac-1f1c-404c-d0eb-c5da7f4a51a1",
                "level": 8,
                "security": "auto"
              }
            ]
          }
        ]
      },
      "streamSettings": {
        "network": "ws",
        "security": "tls",
        "tlsSettings": {
          "allowInsecure": false,
          "serverName": ""
        },
        "wsSettings": {
          "headers": {
            "Host": ""
          },
          "path": "/c77836ac-1f1c-404c-d0eb-c5da7f4a51a1"
        }
      },
      "tag": "proxy"
    },
    {
      "protocol": "freedom",
      "settings": {},
      "tag": "direct"
    },
    {
      "protocol": "blackhole",
      "settings": {
        "response": {
          "type": "http"
        }
      },
      "tag": "block"
    },
    {
      "protocol": "dns",
      "tag": "dns-out"
    }
  ],
  "policy": {
    "levels": {
      "8": {
        "connIdle": 300,
        "downlinkOnly": 1,
        "handshake": 4,
        "uplinkOnly": 1
      }
    },
    "system": {
      "statsOutboundUplink": true,
      "statsOutboundDownlink": true
    }
  },
  "routing": {
    "domainStrategy": "IPIfNonMatch",
    "rules": [
      {
        "inboundTag": [
          "dns-in"
        ],
        "outboundTag": "dns-out",
        "type": "field"
      },
      {
        "ip": [
          "1.1.1.1"
        ],
        "outboundTag": "proxy",
        "port": "53",
        "type": "field"
      },
      {
        "ip": [
          "223.5.5.5"
        ],
        "outboundTag": "direct",
        "port": "53",
        "type": "field"
      },
      {
        "domain": [
          "domain:googleapis.cn"
        ],
        "outboundTag": "proxy",
        "type": "field"
      },
      {
        "ip": [
          "geoip:private"
        ],
        "outboundTag": "direct",
        "type": "field"
      },
      {
        "ip": [
          "geoip:cn"
        ],
        "outboundTag": "direct",
        "type": "field"
      },
      {
        "domain": [
          "geosite:cn"
        ],
        "outboundTag": "direct",
        "type": "field"
      }
    ]
  },
  "stats": {}
}
```
### 4. 启动 v2rayn

```sh
[root@VM-16-9-centos v2ray]# systemctl start v2ray
[root@VM-16-9-centos v2ray]# systemctl status v2ray
● v2ray.service - V2Ray Service
   Loaded: loaded (/etc/systemd/system/v2ray.service; enabled; vendor preset: disabled)
  Drop-In: /etc/systemd/system/v2ray.service.d
           └─10-donot_touch_single_conf.conf
   Active: active (running) since Mon 2022-12-05 19:28:26 CST; 4s ago
     Docs: https://www.v2fly.org/
 Main PID: 4594 (v2ray)
    Tasks: 8
   Memory: 34.0M
   CGroup: /system.slice/v2ray.service
           └─4594 /usr/local/bin/v2ray run -config /usr/local/etc/v2ray/config.json

Dec 05 19:28:26 VM-16-9-centos systemd[1]: Stopped V2Ray Service.
Dec 05 19:28:26 VM-16-9-centos systemd[1]: Started V2Ray Service.
Dec 05 19:28:26 VM-16-9-centos v2ray[4594]: V2Ray 5.1.0 (V2Fly, a community-driven edition of V2Ray.) Custom (go1.19 linux/amd64)
Dec 05 19:28:26 VM-16-9-centos v2ray[4594]: A unified platform for anti-censorship.
Dec 05 19:28:28 VM-16-9-centos v2ray[4594]: 2022/12/05 19:28:28 [Warning] V2Ray 5.1.0 started
[root@VM-16-9-centos v2ray]# netstat -lntp |grep v2ray
tcp        0      0 127.0.0.1:10853         0.0.0.0:*               LISTEN      4594/v2ray          
tcp        0      0 127.0.0.1:10808         0.0.0.0:*               LISTEN      4594/v2ray          
tcp        0      0 127.0.0.1:10809         0.0.0.0:*               LISTEN      4594/v2ray
```

### 5. 配置代理

```sh
[root@VM-16-9-centos ~]# vim /etc/profile.d/proxy.sh

# 想执行wget或者curl来下载国外的东西，可以使用如下代理
export http_proxy="http://127.0.0.1:10809"
export https_proxy="http://127.0.0.1:10809"

# socks5
export http_proxy="socks5://127.0.0.1:10808"
export https_proxy="socks5://127.0.0.1:10808"

[root@VM-16-9-centos ~]# source /etc/profile.d/proxy.sh
[root@VM-16-9-centos ~]# curl -I -L https://www.google.com
HTTP/1.1 200 OK
Content-Type: text/html; charset=ISO-8859-1
Cross-Origin-Opener-Policy-Report-Only: same-origin-allow-popups; report-to="gws"
Report-To: {"group":"gws","max_age":2592000,"endpoints":[{"url":"https://csp.withgoogle.com/csp/report-to/gws/other"}]}
P3P: CP="This is not a P3P policy! See g.co/p3phelp for more info."
Date: Mon, 05 Dec 2022 11:37:39 GMT
Server: gws
X-XSS-Protection: 0
X-Frame-Options: SAMEORIGIN
Transfer-Encoding: chunked
Expires: Mon, 05 Dec 2022 11:37:39 GMT
Cache-Control: private
Set-Cookie: 1P_JAR=2022-12-05-11; expires=Wed, 04-Jan-2023 11:37:39 GMT; path=/; domain=.google.com; Secure
Set-Cookie: AEC=AakniGMfMnVSq7CsrrJEGV7z0GlI4F0cOCsI9hlWeqn-tgfpeGOiOhYH8g; expires=Sat, 03-Jun-2023 11:37:39 GMT; path=/; domain=.google.com; Secure; HttpOnly; SameSite=lax
Set-Cookie: NID=511=uGcURzQh2YxLa92TOC4V0RTAqe93ZuMAIjULMtsX_om5fAXzXNh3bwCGWYB2KC5GfwtymLQ-DaA-oNT1-QtSNK9wQ4Rh-NO9SnZRVKEwjXlJ2BhbVWt4f3l2p60d_h6Q0Ax9ti91irHhytZsZfYMknAjzQdbfO0knWfei0y_W3E; expires=Tue, 06-Jun-2023 11:37:39 GMT; path=/; domain=.google.com; HttpOnly
Alt-Svc: h3=":443"; ma=2592000,h3-29=":443"; ma=2592000,h3-Q050=":443"; ma=2592000,h3-Q046=":443"; ma=2592000,h3-Q043=":443"; ma=2592000,quic=":443"; ma=2592000; v="46,43"

# 测试访问国内是否正常
[root@VM-16-9-centos v2ray]# curl -I -L https://www.baidu.com
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
Connection: keep-alive
Content-Length: 277
Content-Type: text/html
Date: Mon, 05 Dec 2022 12:07:29 GMT
Etag: "575e1f59-115"
Last-Modified: Mon, 13 Jun 2016 02:50:01 GMT
Pragma: no-cache
Server: bfe/1.0.8.18
```

### 6. 配置 docker 代理

```sh
[root@VM-16-9-centos v2ray]# mkdir /etc/systemd/system/docker.service.d
[root@VM-16-9-centos v2ray]# vim /etc/systemd/system/docker.service.d/http-proxy.conf
[Service]
Environment="HTTP_PROXY=http://127.0.0.1:10809" "NO_PROXY=localhost,127.0.0.1"
Environment="HTTPS_PROXY=http://127.0.0.1:10809" "NO_PROXY=localhost,127.0.0.1"
[root@VM-16-9-centos v2ray]# systemctl daemon-reload
[root@VM-16-9-centos v2ray]# systemctl restart docker
[root@VM-16-9-centos v2ray]# docker pull k8s.gcr.io/k8s-dns-kube-dns:1.15.10
1.15.10: Pulling from k8s-dns-kube-dns
39fafc05754f: Pull complete
2e6f1429f7ea: Pull complete
Digest: sha256:7f1c5078c7efac7b18e90725136fca67c0eeb3e1b5fe5c9af200022758c8d443
Status: Downloaded newer image for k8s.gcr.io/k8s-dns-kube-dns:1.15.10
k8s.gcr.io/k8s-dns-kube-dns:1.15.10
```

## 八、Linux 安装 clash 客户端

### 1. 准备安装 clash

官方地址：https://github.com/Dreamacro/clash/releases

```sh
[root@VM-16-9-centos clash]# ls
clash-linux-amd64-v1.8.0.gz
[root@VM-16-9-centos clash]# gunzip clash-linux-amd64-v1.8.0.gz
[root@VM-16-9-centos clash]# ls
clash-linux-amd64-v1.8.0
[root@VM-16-9-centos clash]# mv clash-linux-amd64-v1.8.0 /usr/local/bin/clash
[root@VM-16-9-centos clash]# chmod +x /usr/local/bin/clash
[root@VM-16-9-centos clash]# ll /usr/local/bin/clash
-rwxr-xr-x 1 root root 9388032 Jan 12 11:31 /usr/local/bin/clash
[root@VM-16-9-centos clash]# clash
INFO[0000] Can't find config, create a initial config file
INFO[0000] Can't find MMDB, start download              
INFO[0381] Mixed(http+socks) proxy listening at: 127.0.0.1:7890
[root@VM-16-9-centos clash]# ls -al ~/.config/clash
total 12
drwxr-xr-x 2 root root 4096 Jan 12 11:33 .
drwxr-xr-x 5 root root 4096 Jan 12 11:33 ..
-rw-r--r-- 1 root root   16 Jan 12 11:33 config.yaml
-rw-r--r-- 1 root root   16 Jan 12 11:33 Country.mmdb
```

**配置systemd管理服务**

```sh
[root@VM-16-9-centos clash]# pwd
/root/.config/clash
[root@VM-16-9-centos clash]# ls
cache.db  config.yaml  Country.mmdb
[root@VM-16-9-centos clash]# mkdir /etc/clash
[root@VM-16-9-centos clash]# cp * /etc/clash/
[root@VM-16-9-centos clash]# cd /etc/clash/
[root@VM-16-9-centos clash]# vim /etc/systemd/system/clash.service
[Unit]
Description=Clash Daemon

[Service]
ExecStart=/usr/local/bin/clash -d /etc/clash/
Restart=on-failure

[Install]
WantedBy=multi-user.target
```

### 2. 导入订阅

使用Windows clash 将 Windows 中的配置文件传输到 Linux 中，命名为config.yaml

![](/images/posts/other/利用国外VPS搭建VPN服务/32.png)

![](/images/posts/other/利用国外VPS搭建VPN服务/33.png)

![](/images/posts/other/利用国外VPS搭建VPN服务/34.png)

```sh
[root@VM-16-9-centos clash]# mv 1673083468983.yml config.yaml
[root@VM-16-9-centos clash]# systemctl enable clash --now
Created symlink from /etc/systemd/system/multi-user.target.wants/clash.service to /etc/systemd/system/clash.service.
[root@VM-16-9-centos clash]# systemctl status clash
● clash.service - Clash Daemon
   Loaded: loaded (/etc/systemd/system/clash.service; enabled; vendor preset: disabled)
   Active: active (running) since Thu 2023-01-12 13:10:58 CST; 4s ago
 Main PID: 29545 (clash)
    Tasks: 9
   Memory: 7.1M
   CGroup: /system.slice/clash.service
           └─29545 /usr/local/bin/clash -d /etc/clash/

Jan 12 13:10:58 VM-16-9-centos systemd[1]: Started Clash Daemon.
Jan 12 13:10:58 VM-16-9-centos clash[29545]: time="2023-01-12T13:10:58+08:00" level=info msg="Start initial compatible provider 故障转移"
Jan 12 13:10:58 VM-16-9-centos clash[29545]: time="2023-01-12T13:10:58+08:00" level=info msg="Start initial compatible provider 自动选择"
Jan 12 13:10:58 VM-16-9-centos clash[29545]: time="2023-01-12T13:10:58+08:00" level=info msg="Start initial compatible provider Bitz Net"
Jan 12 13:10:58 VM-16-9-centos clash[29545]: time="2023-01-12T13:10:58+08:00" level=info msg="Mixed(http+socks) proxy listening at: [::]:7890"
Jan 12 13:10:58 VM-16-9-centos clash[29545]: time="2023-01-12T13:10:58+08:00" level=info msg="RESTful API listening at: 127.0.0.1:9090"
[root@VM-16-9-centos clash]# netstat -lntp |grep clash
tcp        0      0 127.0.0.1:9090          0.0.0.0:*               LISTEN      29545/clash         
tcp6       0      0 :::7890                 :::*                    LISTEN      29545/clash
```

### 3. 配置本地代理

```sh
[root@VM-16-9-centos clash]# vim /etc/profile.d/proxy.sh
# 代理
export http_proxy="http://127.0.0.1:7890"
export https_proxy="http://127.0.0.1:7890"
export all_proxy="socks5://127.0.0.1:7890"

[root@VM-16-9-centos clash]# source /etc/profile.d/proxy.sh
[root@VM-16-9-centos clash]# curl -I www.google.com
HTTP/1.1 200 OK
Transfer-Encoding: chunked
Cache-Control: private
Connection: keep-alive
Content-Type: text/html; charset=ISO-8859-1
Cross-Origin-Opener-Policy-Report-Only: same-origin-allow-popups; report-to="gws"
Date: Thu, 12 Jan 2023 05:15:12 GMT
Expires: Thu, 12 Jan 2023 05:15:12 GMT
Keep-Alive: timeout=4
P3p: CP="This is not a P3P policy! See g.co/p3phelp for more info."
Proxy-Connection: keep-alive
Report-To: {"group":"gws","max_age":2592000,"endpoints":[{"url":"https://csp.withgoogle.com/csp/report-to/gws/other"}]}
Server: gws
Set-Cookie: 1P_JAR=2023-01-12-05; expires=Sat, 11-Feb-2023 05:15:12 GMT; path=/; domain=.google.com; Secure
Set-Cookie: AEC=ARSKqsInZpMMmT4PVaX4dpey-bw-Tx2_0jWAZle6iUVeRkqusmSdMzsVXQ; expires=Tue, 11-Jul-2023 05:15:12 GMT; path=/; domain=.google.com; Secure; HttpOnly; SameSite=lax
Set-Cookie: NID=511=g7Jr2pJ9MW6Y5t3Blfu1rXut_XzSURmB1wvmWNDaYPXkFU-QF-K_YmSqxVkP-YDcExiWjoLXV0_XNXmQKYW1SApQrH3gi7ICDHVKlCwQqub3OYf0bqAD5_n1pfrjg6fWHna-kqGm69kJiJ4s7jrUdpmrkUr_EJd0abG_3zx_wWI; expires=Fri, 14-Jul-2023 05:15:12 GMT; path=/; domain=.google.com; HttpOnly
X-Frame-Options: SAMEORIGIN
X-Xss-Protection: 0
```

## 九、其他

> 联系我获得我的机场

### 1. 命令行使用代理

CMD

```sh
set http_proxy=http://127.0.0.1:7890
set https_proxy=http://127.0.0.1:7890
```

powershell

```sh
$env http_proxy=http://127.0.0.1:7890
$env https_proxy=http://127.0.0.1:7890
```

git-bash

```sh
export http_proxy=http://127.0.0.1:7890
export https_proxy=http://127.0.0.1:7890
```

mac linux 使用代理

```sh
$ vim  ~/.bash_profile

export https_proxy=http://127.0.0.1:7890
export http_proxy=http://127.0.0.1:7890
export all_proxy=socks5://127.0.0.1:7890

$ source ~/.bash_profile
```
